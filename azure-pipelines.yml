# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- main

pool:
  vmImage: ubuntu-latest

- task: Docker@2
  inputs:
    repository: 'private-cloud.registry.mendix.com'
    command: 'buildAndPush'
    Dockerfile: '**/Dockerfile'

steps:
- script: |
   echo " Downloading latest mxpc pipeline image"
   docker pull mxpc-pipeline-tools-cli:0.0.4 
  displayName: "Downloading latest mxpc pipeline image"

- script: |
    echo Executing mxpc-pipeline-tools-cli
    docker run -it private-cloud.registry.mendix.com/mxpc-pipeline-tools-cli:0.0.4 ./mxpc-pipeline-tools-cli
  displayName: 'Executing mxpc-pipeline-tools-cli to create MendixApp'